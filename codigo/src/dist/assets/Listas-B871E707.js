import"./style-C1Vxo-0u.js";import"./bootstrap.esm-DHJneFca.js";class b{constructor(t,a,i,l){this._id=t,this.titulo=a,this.linhas=i,this.coordenadas=l}}var L=200,g=100;const m=6;var r="elementosParticipantes";Array(m).fill(!0);var d=[];for(var h=0;h<3;h++)d.push(Array(m).fill(!0));var o=localStorage.getItem("ultimaLista")||"ListaParticipantes",n=0,s=[];o==="ListaParticipantes"&&($(".listaParticipantes").addClass("active"),$(".listaInsumos, .listaServicos").removeClass("active"),n=0,r="elementosParticipantes",c());o==="ListaInsumos"&&($(".listaInsumos").addClass("active"),$(".listaParticipantes, .listaServicos").removeClass("active"),n=1,r="elementosInsumos",c());o==="ListaServicos"&&($(".listaServicos").addClass("active"),$(".listaParticipantes, .listaInsumos").removeClass("active"),n=2,r="elementosServicos",c());function c(){if($(".card").parent().remove(),s=JSON.parse(localStorage.getItem(o)),s){let e=0;for(let t=0;t<m;t++)if(s[t]!=null){let a=new b(s[t]._id,s[t].titulo,s[t].linhas,s[t].coordenadas),i=k(a,e++);I(i),y(i),S(i),C(i),x(i),$("section").append(i),d[n][t]=!1}else d[n][t]=!0,console.log("entrou")}else s=[]}$(document).ready(()=>{c(),$("#adicionaCard").click(()=>{let e=-1;for(var t=0;t<m;t++)if(d[n][t]===!0){d[n][t]=!1,e=t;break}if(e===-1){$(".toast-body").text("O Número máximo de cards para esta categoria foi atingido."),$(".toast").toast("show");return}var a=new b(e,"Lista "+(e+1)," ",null),i=k(a,e);I(i),y(i),S(i),C(i),x(i),s[e]=a,localStorage.setItem(o,JSON.stringify(s)),$("section").append(i)}),$("#removeCard").click(()=>{$(".card").parent().remove(),d[n].fill(!0),s=[],localStorage.setItem(o,JSON.stringify(s));let e=JSON.parse(localStorage.getItem(r))||[];e.fill(null),localStorage.setItem(r,JSON.stringify(e))}),$("#organizaCard").click(()=>{s=JSON.parse(localStorage.getItem(o));for(let e=0;e<s.length;e++)s[e]!=null&&(s[e].coordenadas=null);localStorage.setItem(o,JSON.stringify(s)),c()}),$(".listaParticipantes").click(()=>{$("#tipoLista").find("i").removeClass("bi-cash-stack bi-briefcase").addClass("bi-people"),$("#tipoLista").find("span").text("Participantes"),$(".listaParticipantes").addClass("active"),$(".listaInsumos, .listaServicos").removeClass("active"),o="ListaParticipantes",r="elementosServicos",localStorage.setItem("ultimaLista",o),n=0,localStorage.setItem("ultimaListaPosicao",n),c()}),$(".listaInsumos").click(()=>{$("#tipoLista").find("i").removeClass("bi-people bi-briefcase").addClass("bi-cash-stack"),$("#tipoLista").find("span").text("Insumos"),$(".listaInsumos").addClass("active"),$(".listaParticipantes, .listaServicos").removeClass("active"),o="ListaInsumos",r="elementosInsumos",localStorage.setItem("ultimaLista",o),n=1,localStorage.setItem("ultimaListaPosicao",n),c()}),$(".listaServicos").click(()=>{$("#tipoLista").find("i").removeClass("bi-people bi-cash-stack").addClass("bi-briefcase"),$("#tipoLista").find("span").text("Serviços"),$(".listaServicos").addClass("active"),$(".listaParticipantes, .listaInsumos").removeClass("active"),o="ListaServicos",localStorage.setItem("ultimaLista",o),r="elementosServicos",n=2,localStorage.setItem("ultimaListaPosicao",n),c()})});function S(e){e.find(".nomeiaCard").click(function(){let t=$(this).closest(".card-container").find(".card-header span:first-child");t.attr("contenteditable","true"),t.focus(),O(t[0]),$(".card-container").not($(this).closest(".card-container")).css("position","fixed"),$(this).closest(".card-container").css("z-index","1"),$(".card-container").not($(this).closest(".card-container")).css("z-index","0"),t.blur(function(){v($(this))}),t.on("keydown click",function(a){if(a.keyCode===13){a.preventDefault(),v($(this)),t.attr("contenteditable","false");let l=$(this).closest(".card-container").find(".list-group").find("li:last-child").focus();u(l[0])}else($(this).width()>=L||$(this).text().length>=g)&&!P(t[0])&&a.keyCode!==8&&a.keyCode!==46&&a.keyCode!==37&&a.keyCode!==39&&!a.ctrlKey&&(a.preventDefault(),$(".toast-body").text("Tamanho máximo de título atingido."),$(".toast").toast("show"));if($(this).text().length>g){let i=$(this).text().substring(0,g);t.text(i)}})})}function C(e){e.find(".resetaCard").click(function(){$(this).closest(".card-container").find(".list-group li").remove();let t=$('<li class="list-group-item fw-lighter" contenteditable="true"></li>').text("");$(this).closest(".card-container").find(".list-group").append(t),t.focus();let a=$(this).closest(".card-container").attr("id"),i=parseInt(a.split("-")[1]);s[i].linhas=[],localStorage.setItem(o,JSON.stringify(s))})}function x(e){e.find(".removeCard").click(function(){let t=$(this).closest(".card-container").attr("id"),a=parseInt(t.split("-")[1]);$(this).closest(".card-container").remove(),s[a]=null,localStorage.setItem(o,JSON.stringify(s)),d[n][a]=!0;let i=JSON.parse(localStorage.getItem(r))||[];i[a].coordenadas=null,localStorage.setItem(r,JSON.stringify(i))})}function u(e){if(e&&e.childNodes&&e.childNodes.length>0){let t=document.createRange(),a=window.getSelection();t.setStart(e.childNodes[0],e.childNodes[0].length),t.collapse(!0),a.removeAllRanges(),a.addRange(t)}}function N(e){e.find(".list-group-item").each(function(){$(this).text().trim()===""&&e.find(".list-group-item").length>1&&($(this).remove(),f(e))})}function v(e){let t=e.text().trim();if(t!==""){e.text(t);let a=e.closest(".card-container").attr("id"),i=parseInt(a.split("-")[1]);s[i].titulo=t,localStorage.setItem(o,JSON.stringify(s))}}function f(e){let t=[];e.find(".list-group-item").each(function(){t.push($(this).text().trim())});let a=e.closest(".card-container").attr("id");if(a!=null){let i=parseInt(a.split("-")[1]);s[i].linhas=t,localStorage.setItem(o,JSON.stringify(s)),console.log("Conteúdo salvo no card de ID "+i+" como: "+t)}}function P(e){let a=window.getSelection().toString(),i=e.textContent;return a===i}function I(e){e.find(".draggable").draggable({containment:"section",scroll:!1,snap:!1,stack:".draggable",cursor:"grabbing",handle:".card-header",stop:function(){$(this).closest(".card-container").css("position","absolute");let t=$(this).closest(".card-container").attr("id"),a=parseInt(t.split("-")[1]);s[a].coordenadas=[$(this).offset().left-48,$(this).offset().top],localStorage.setItem(o,JSON.stringify(s)),console.log("Coordenadas salvas no card de ID "+a+" como: "+s[a].coordenadas)}})}function y(e){e.find(".list-group").on("keydown",function(t){let a=$(this).closest(".card-container").find(".list-group"),i=$(".card-container").not($(this).closest(".card-container")),l=a.find("li:focus");if(a.on("blur","li",function(){f(a)}),(t.keyCode===8||t.keyCode===38||t.keyCode===40)&&l.text()===""&&a.children().length>1){t.preventDefault(),l.remove();var w=a.find("li:last-child").focus();u(w[0])}if(t.keyCode===13&&l.text()===""){t.preventDefault();return}if(t.keyCode===13){t.preventDefault();let p=$('<li class="list-group-item fw-lighter" contenteditable="true"></li>').text("");i.css("position","fixed"),a.append(p),p.focus(),u(p[0]),f($(this).closest(".card-container"))}t.keyCode===38&&(t.preventDefault(),l.prev().focus(),u(l.prev()[0])),t.keyCode===40&&(t.preventDefault(),l.next().focus(),u(l.next()[0])),$(document).click(function(){$(".card-container").each(function(){N($(this))}),f($(this).closest(".card-container"))})})}function O(e){if(document.body.createTextRange){var t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){var t=document.createRange();t.selectNodeContents(e);var a=window.getSelection();a.removeAllRanges(),a.addRange(t)}}function k(e,t){var a='<li class="list-group-item fw-lighter" contenteditable="true"></li>';if(e.linhas.length!==0&&e.linhas[0]!==""){a="";for(let l=0;l<e.linhas.length;l++)e.linhas[l]!==""&&(a+='<li class="list-group-item fw-lighter" contenteditable="true">'+e.linhas[l]+"</li>")}let i="";return e.coordenadas==null?i="top: "+(t+1)+"0%;":i="top: "+e.coordenadas[1]+"px; left: "+e.coordenadas[0]+"px;",$(`<div id="card-${e._id}" class="bg-dark card-container ms-5" style="${i}; width: 0%;">
        <div class="cardConvidado draggable card col-3 shadow border-0 rounded-1 overflow-x-hidden">
        <div class="card-header fs-4 fw-bolder text-nowrap d-flex justify-content-between align-items-center">
        <span class="mt-3 mb-1 lh-1 pt-2 fs-md-1">${e.titulo}</span>
        <span class="position-absolute end-0 top-0 m-0 p-0">
            <button type="button" class="btn bi-arrow-clockwise resetaCard btn-sm"></button>
            <button type="button" class="btn bi-pen nomeiaCard btn-sm"></button>
            <button type="button" class="btn bi-x-lg removeCard btn-sm" aria-label="Close"></button>
        </span>
        </div>
        <div class="card-body overflow-auto mx-1 p-0" style="max-height: 500px">
        <ul class="list-group list-group-flush mx-0 px-0"> 
            ${a}
        </ul>
        </div>
        </div>
        </div>`)}
